<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪物问题详细调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .debug-info {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        .coordinate-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .coord-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            padding: 15px;
        }
        .coord-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .success {
            color: #4ecdc4;
            font-weight: bold;
        }
        .warning {
            color: #ffd93d;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>🔍 怪物问题详细调试</h1>
    
    <div class="debug-section">
        <h2>📋 调试步骤</h2>
        <ol>
            <li>打开游戏页面 (index.html)</li>
            <li>按F12打开开发者工具</li>
            <li>切换到Console标签</li>
            <li>开始游戏</li>
            <li>观察控制台输出</li>
            <li>点击下面的按钮进行分析</li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>🔍 关键调试信息</h2>
        <div class="coordinate-info">
            <div class="coord-card">
                <h3>🎮 游戏配置</h3>
                <div>屏幕宽度: 1440px</div>
                <div>屏幕高度: 2560px</div>
                <div>玩家初始Y: 1280px</div>
                <div>玩家移动速度: 780px/s</div>
                <div>生成间距: 300px</div>
            </div>
            <div class="coord-card">
                <h3>👹 关卡1配置</h3>
                <div>油桶怪: 15个</div>
                <div>UFO炮塔: 8个</div>
                <div>巨型怪: 3个</div>
                <div>总怪物数: 26个</div>
                <div>关卡时长: 80秒</div>
            </div>
            <div class="coord-card">
                <h3>📐 位置计算</h3>
                <div>安全距离: 1950px</div>
                <div>总距离: ~31200px</div>
                <div>生成点数: ~104个</div>
                <div>激活距离: 3840px</div>
                <div>第一个怪物Y: -970px</div>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>🔍 查找的调试信息</h2>
        <div class="debug-info" id="debugInfo">
            等待调试信息...
        </div>
        <button onclick="checkGenerationInfo()">检查生成信息</button>
        <button onclick="checkActivationInfo()">检查激活信息</button>
        <button onclick="checkRenderingInfo()">检查渲染信息</button>
        <button onclick="clearDebugInfo()">清空信息</button>
    </div>

    <div class="debug-section">
        <h2>📊 可能的问题和解决方案</h2>
        <div class="debug-info">
            <strong class="error">问题1: 怪物没有生成</strong><br>
            查找: "怪物生成完成" 和 "总生成怪物数量" 日志<br>
            如果显示 "❌ 没有生成任何怪物！"，说明生成逻辑有问题<br>
            解决: 检查关卡配置和生成条件<br><br>
            
            <strong class="warning">问题2: 怪物生成但数量为0</strong><br>
            查找: "跳过生成点" 日志<br>
            如果所有生成点都被跳过，说明数量限制过严<br>
            解决: 检查MAX_BARREL_MONSTERS等限制<br><br>
            
            <strong class="warning">问题3: 怪物生成但位置错误</strong><br>
            查找: "前5个怪物位置" 日志<br>
            检查怪物Y坐标是否合理<br>
            解决: 检查位置计算逻辑<br><br>
            
            <strong class="error">问题4: 怪物没有激活</strong><br>
            查找: "激活怪物" 日志<br>
            如果没有激活日志，说明激活条件有问题<br>
            解决: 检查distanceToPlayer计算<br><br>
            
            <strong class="error">问题5: 怪物激活但不可见</strong><br>
            查找: "怪物不在视野内" 日志<br>
            如果怪物被激活但不在视野内，说明摄像机问题<br>
            解决: 检查camera.isInView方法
        </div>
    </div>

    <div class="debug-section">
        <h2>🎯 快速诊断</h2>
        <button onclick="diagnoseIssue()">自动诊断</button>
        <button onclick="testCoordinateCalculation()">测试坐标计算</button>
        <button onclick="testActivationLogic()">测试激活逻辑</button>
    </div>

    <script>
        function checkGenerationInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>怪物生成信息检查:</strong><br><br>
                
                <strong>1. 查找生成完成信息:</strong><br>
                - "怪物生成完成: Barrel=X/15, UFO=Y/8, Giant=Z/3"<br>
                - "总生成怪物数量: X"<br><br>
                
                <strong>2. 查找生成点信息:</strong><br>
                - "生成点0: 可用类型=barrel,ufo,giant, 当前计数=(Barrel:0, UFO:0, Giant:0)"<br>
                - "生成点1: 可用类型=barrel,ufo,giant, 当前计数=(Barrel:1, UFO:0, Giant:0)"<br><br>
                
                <strong>3. 查找跳过信息:</strong><br>
                - "跳过生成点X: 所有怪物类型已达上限"<br><br>
                
                <strong>4. 查找怪物位置:</strong><br>
                - "前5个怪物位置:"<br>
                - "怪物1: BarrelMonster at (720.0, -970.0)"<br><br>
                
                <strong>如果没有看到这些信息，请:</strong><br>
                1. 确保游戏已经开始<br>
                2. 等待几秒钟<br>
                3. 检查是否有JavaScript错误
            `;
        }

        function checkActivationInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>怪物激活信息检查:</strong><br><br>
                
                <strong>1. 查找激活信息:</strong><br>
                - "激活怪物: BarrelMonster at (720.0, -970.0), 距离玩家: 2250.0"<br>
                - "玩家位置: (720.0, 1280.0)"<br>
                - "摄像机位置: (720.0, 1280.0)"<br><br>
                
                <strong>2. 激活条件:</strong><br>
                - 距离玩家 < 3840px (1.5倍屏幕高度)<br>
                - 玩家Y - 怪物Y < 3840<br>
                - 1280 - (-970) = 2250 < 3840 ✓<br><br>
                
                <strong>3. 如果没有激活信息:</strong><br>
                - 检查怪物是否真的生成了<br>
                - 检查玩家是否在移动<br>
                - 检查激活条件计算
            `;
        }

        function checkRenderingInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>怪物渲染信息检查:</strong><br><br>
                
                <strong>1. 查找视野检查信息:</strong><br>
                - "怪物不在视野内: 世界坐标(720.0, -970.0) -> 屏幕坐标(720.0, 280.0)"<br><br>
                
                <strong>2. 视野检查条件:</strong><br>
                - screenX + width >= 0: 720 + 300 >= 0 ✓<br>
                - screenX <= 1440: 720 <= 1440 ✓<br>
                - screenY + height >= 0: 280 + 450 >= 0 ✓<br>
                - screenY <= 2560: 280 <= 2560 ✓<br><br>
                
                <strong>3. 视觉调试:</strong><br>
                - 如果怪物被激活，会显示红色边框<br>
                - 红色边框表示怪物已激活但正常渲染失败<br><br>
                
                <strong>4. 如果没有渲染信息:</strong><br>
                - 怪物可能没有被激活<br>
                - 或者摄像机视野检查有问题
            `;
        }

        function clearDebugInfo() {
            document.getElementById('debugInfo').innerHTML = '等待调试信息...';
        }

        function diagnoseIssue() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>自动诊断结果:</strong><br><br>
                
                <strong>最可能的问题:</strong><br>
                1. 怪物生成数量限制过严<br>
                2. 怪物位置计算错误<br>
                3. 激活条件不满足<br>
                4. 摄像机视野检查问题<br><br>
                
                <strong>建议检查顺序:</strong><br>
                1. 查看控制台是否有 "❌ 没有生成任何怪物！"<br>
                2. 查看是否有 "跳过生成点" 信息<br>
                3. 查看是否有 "激活怪物" 信息<br>
                4. 查看是否有 "怪物不在视野内" 信息<br><br>
                
                <strong>快速修复建议:</strong><br>
                1. 如果怪物数量为0，检查关卡配置<br>
                2. 如果怪物位置错误，检查位置计算<br>
                3. 如果怪物不激活，检查激活条件<br>
                4. 如果怪物不渲染，检查摄像机系统
            `;
        }

        function testCoordinateCalculation() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>坐标计算测试:</strong><br><br>
                
                <strong>玩家初始位置:</strong><br>
                X: 720px, Y: 1280px<br><br>
                
                <strong>怪物生成计算:</strong><br>
                安全距离: 5秒 × 780px/s = 1950px<br>
                生成间距: 300px<br>
                第一个怪物Y: 1280 - 1950 - 300 = -970px<br>
                第二个怪物Y: 1280 - 1950 - 600 = -1270px<br><br>
                
                <strong>激活条件测试:</strong><br>
                距离 = 玩家Y - 怪物Y<br>
                距离 = 1280 - (-970) = 2250px<br>
                激活阈值 = 2560 × 1.5 = 3840px<br>
                2250 < 3840 ✓ 应该激活<br><br>
                
                <strong>摄像机视野测试:</strong><br>
                摄像机Y = 玩家Y = 1280px<br>
                怪物屏幕Y = 怪物Y - 摄像机Y + 屏幕中心Y<br>
                怪物屏幕Y = -970 - 1280 + 1280 = -970px<br>
                但是怪物在玩家前方，应该是正数<br>
                可能有问题！
            `;
        }

        function testActivationLogic() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>激活逻辑测试:</strong><br><br>
                
                <strong>当前激活条件:</strong><br>
                distanceToPlayer = this.player.y - enemy.y<br>
                if (distanceToPlayer < CONFIG.GAME.CANVAS_HEIGHT * 1.5)<br><br>
                
                <strong>问题分析:</strong><br>
                1. 玩家向上移动，Y坐标越来越小<br>
                2. 怪物在玩家前方，Y坐标比玩家小（负值更大）<br>
                3. distanceToPlayer = 玩家Y - 怪物Y<br>
                4. 如果怪物Y = -970，玩家Y = 1280<br>
                5. distanceToPlayer = 1280 - (-970) = 2250<br><br>
                
                <strong>可能的问题:</strong><br>
                1. 怪物位置计算错误<br>
                2. 激活条件逻辑错误<br>
                3. 玩家移动方向理解错误<br><br>
                
                <strong>建议修复:</strong><br>
                检查怪物生成位置计算是否正确
            `;
        }

        // 页面加载时的提示
        window.onload = function() {
            checkGenerationInfo();
        };
    </script>
</body>
</html>




