<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ªç‰©æ¿€æ´»æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background-color: #2d5a2d;
            border-left: 4px solid #4caf50;
        }
        .info {
            background-color: #2d4a5a;
            border-left: 4px solid #2196f3;
        }
        .warning {
            background-color: #5a4a2d;
            border-left: 4px solid #ff9800;
        }
        .error {
            background-color: #5a2d2d;
            border-left: 4px solid #f44336;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        #log {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .coordinate-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .coordinate-table th, .coordinate-table td {
            border: 1px solid #4ecdc4;
            padding: 8px;
            text-align: center;
        }
        .coordinate-table th {
            background-color: rgba(78, 205, 196, 0.2);
        }
    </style>
</head>
<body>
    <h1>ğŸ‘¹ æ€ªç‰©æ¿€æ´»æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ é—®é¢˜åˆ†æ</h2>
        <div class="test-result info">
            <strong>ğŸ” é—®é¢˜å‘ç°</strong><br>
            æµ‹è¯•å·¥å…·æ˜¾ç¤ºç”Ÿæˆäº†27ä¸ªæ€ªç‰©ï¼Œä½†æ¸¸æˆä¸­æ²¡æœ‰æ˜¾ç¤ºï¼Œè¯´æ˜é—®é¢˜åœ¨äºæ€ªç‰©æ¿€æ´»é€»è¾‘ã€‚
        </div>
        <div class="test-result warning">
            <strong>âš ï¸ åŸå› åˆ†æ</strong><br>
            æ€ªç‰©æ¿€æ´»æ¡ä»¶ï¼š<code>enemy.y > player.y - 1.5 * CANVAS_HEIGHT</code><br>
            è¿™ä¸ªæ¡ä»¶åœ¨ç©å®¶å‘ä¸Šç§»åŠ¨æ—¶å¯èƒ½æ°¸è¿œä¸ä¼šæ»¡è¶³ã€‚
        </div>
        <div class="test-result pass">
            <strong>âœ… ä¿®å¤æ–¹æ¡ˆ</strong><br>
            æ”¹ä¸ºï¼š<code>player.y - enemy.y < 1.5 * CANVAS_HEIGHT</code><br>
            å½“ç©å®¶æ¥è¿‘æ€ªç‰©æ—¶æ¿€æ´»ï¼Œè€Œä¸æ˜¯åŸºäºç»å¯¹åæ ‡ã€‚
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
        <button onclick="testMonsterActivationLogic()">æµ‹è¯•æ€ªç‰©æ¿€æ´»é€»è¾‘</button>
        <button onclick="testCoordinateSystem()">æµ‹è¯•åæ ‡ç³»ç»Ÿ</button>
        <button onclick="testPlayerMovement()">æµ‹è¯•ç©å®¶ç§»åŠ¨</button>
        <button onclick="simulateGameplay()">æ¨¡æ‹Ÿæ¸¸æˆè¿‡ç¨‹</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
        <div id="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        function addResult(type, title, message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `
                <div class="test-result ${type}">
                    <strong>[${timestamp}] ${title}</strong><br>
                    ${message}
                </div>
            `;
        }

        function testMonsterActivationLogic() {
            log('ğŸ‘¹ å¼€å§‹æµ‹è¯•æ€ªç‰©æ¿€æ´»é€»è¾‘...');
            
            // æ¸¸æˆé…ç½®
            const CANVAS_HEIGHT = 2560;
            const PLAYER_START_Y = 1280;
            const PLAYER_MOVE_SPEED = 780; // åƒç´ /ç§’
            const SAFE_DISTANCE = 5 * PLAYER_MOVE_SPEED * 0.5; // 1950åƒç´ 
            const SPAWN_DISTANCE = 300; // æ¯300åƒç´ ä¸€ä¸ªç”Ÿæˆç‚¹
            
            log(`æ¸¸æˆé…ç½®:`);
            log(`- å±å¹•é«˜åº¦: ${CANVAS_HEIGHT}px`);
            log(`- ç©å®¶åˆå§‹Y: ${PLAYER_START_Y}px`);
            log(`- ç©å®¶ç§»åŠ¨é€Ÿåº¦: ${PLAYER_MOVE_SPEED}px/s`);
            log(`- å®‰å…¨è·ç¦»: ${SAFE_DISTANCE}px`);
            log(`- ç”Ÿæˆè·ç¦»: ${SPAWN_DISTANCE}px`);
            
            // æ¨¡æ‹Ÿæ€ªç‰©ç”Ÿæˆä½ç½®
            const monsters = [];
            for (let i = 0; i < 10; i++) {
                const y = PLAYER_START_Y - SAFE_DISTANCE - (i + 1) * SPAWN_DISTANCE;
                monsters.push({
                    id: i + 1,
                    y: y,
                    active: false
                });
            }
            
            log(`\næ€ªç‰©ç”Ÿæˆä½ç½®:`);
            monsters.forEach(monster => {
                log(`æ€ªç‰©${monster.id}: Y=${monster.y}px`);
            });
            
            // æµ‹è¯•æ—§çš„æ¿€æ´»é€»è¾‘
            log(`\næ—§æ¿€æ´»é€»è¾‘æµ‹è¯•:`);
            const oldActivationThreshold = PLAYER_START_Y - CANVAS_HEIGHT * 1.5;
            log(`æ¿€æ´»é˜ˆå€¼: ${oldActivationThreshold}px`);
            
            monsters.forEach(monster => {
                const wouldActivate = monster.y > oldActivationThreshold;
                log(`æ€ªç‰©${monster.id}: Y=${monster.y} > ${oldActivationThreshold} = ${wouldActivate}`);
            });
            
            // æµ‹è¯•æ–°çš„æ¿€æ´»é€»è¾‘
            log(`\næ–°æ¿€æ´»é€»è¾‘æµ‹è¯•:`);
            const activationDistance = CANVAS_HEIGHT * 1.5;
            log(`æ¿€æ´»è·ç¦»: ${activationDistance}px`);
            
            // æ¨¡æ‹Ÿç©å®¶ç§»åŠ¨
            for (let time = 0; time <= 10; time++) {
                const playerY = PLAYER_START_Y - PLAYER_MOVE_SPEED * time;
                log(`\næ—¶é—´${time}ç§’: ç©å®¶Y=${playerY.toFixed(1)}px`);
                
                monsters.forEach(monster => {
                    if (!monster.active) {
                        const distanceToPlayer = playerY - monster.y;
                        const shouldActivate = distanceToPlayer < activationDistance;
                        if (shouldActivate) {
                            monster.active = true;
                            log(`  æ€ªç‰©${monster.id}æ¿€æ´»: è·ç¦»=${distanceToPlayer.toFixed(1)}px`);
                        }
                    }
                });
            }
            
            const activatedMonsters = monsters.filter(m => m.active).length;
            log(`\næ¿€æ´»ç»“æœ: ${activatedMonsters}/${monsters.length} ä¸ªæ€ªç‰©è¢«æ¿€æ´»`);
            
            if (activatedMonsters > 0) {
                addResult('pass', 'æ€ªç‰©æ¿€æ´»é€»è¾‘æµ‹è¯•', `æ–°é€»è¾‘æˆåŠŸæ¿€æ´»${activatedMonsters}ä¸ªæ€ªç‰©`);
            } else {
                addResult('error', 'æ€ªç‰©æ¿€æ´»é€»è¾‘æµ‹è¯•', 'æ–°é€»è¾‘æ²¡æœ‰æ¿€æ´»ä»»ä½•æ€ªç‰©');
            }
        }

        function testCoordinateSystem() {
            log('ğŸ“ å¼€å§‹æµ‹è¯•åæ ‡ç³»ç»Ÿ...');
            
            const CANVAS_HEIGHT = 2560;
            const PLAYER_START_Y = 1280;
            
            log(`åæ ‡ç³»ç»Ÿåˆ†æ:`);
            log(`- å±å¹•é«˜åº¦: ${CANVAS_HEIGHT}px`);
            log(`- ç©å®¶åˆå§‹Y: ${PLAYER_START_Y}px (å±å¹•ä¸­å¤®)`);
            log(`- å±å¹•é¡¶éƒ¨: 0px`);
            log(`- å±å¹•åº•éƒ¨: ${CANVAS_HEIGHT}px`);
            
            // åˆ†ææ€ªç‰©ç”Ÿæˆä½ç½®
            const SAFE_DISTANCE = 1950;
            const SPAWN_DISTANCE = 300;
            
            log(`\næ€ªç‰©ç”Ÿæˆä½ç½®åˆ†æ:`);
            for (let i = 0; i < 5; i++) {
                const monsterY = PLAYER_START_Y - SAFE_DISTANCE - (i + 1) * SPAWN_DISTANCE;
                const relativeToScreen = monsterY < 0 ? 'å±å¹•ä¸Šæ–¹' : 'å±å¹•å†…';
                log(`æ€ªç‰©${i + 1}: Y=${monsterY}px (${relativeToScreen})`);
            }
            
            // åˆ†ææ¿€æ´»æ¡ä»¶
            log(`\næ¿€æ´»æ¡ä»¶åˆ†æ:`);
            const oldThreshold = PLAYER_START_Y - CANVAS_HEIGHT * 1.5;
            const newDistance = CANVAS_HEIGHT * 1.5;
            
            log(`æ—§é€»è¾‘é˜ˆå€¼: ${oldThreshold}px`);
            log(`æ–°é€»è¾‘è·ç¦»: ${newDistance}px`);
            
            if (oldThreshold < 0) {
                log(`æ—§é€»è¾‘é—®é¢˜: é˜ˆå€¼ä¸ºè´Ÿå€¼ï¼Œæ€ªç‰©å¯èƒ½æ°¸è¿œæ— æ³•æ¿€æ´»`);
            }
            
            addResult('info', 'åæ ‡ç³»ç»Ÿæµ‹è¯•', 'åæ ‡ç³»ç»Ÿåˆ†æå®Œæˆ');
        }

        function testPlayerMovement() {
            log('ğŸƒ å¼€å§‹æµ‹è¯•ç©å®¶ç§»åŠ¨...');
            
            const PLAYER_START_Y = 1280;
            const PLAYER_MOVE_SPEED = 780; // åƒç´ /ç§’
            
            log(`ç©å®¶ç§»åŠ¨æ¨¡æ‹Ÿ:`);
            log(`åˆå§‹ä½ç½®: Y=${PLAYER_START_Y}px`);
            log(`ç§»åŠ¨é€Ÿåº¦: ${PLAYER_MOVE_SPEED}px/s (å‘ä¸Š)`);
            
            // æ¨¡æ‹Ÿ10ç§’çš„ç§»åŠ¨
            for (let time = 0; time <= 10; time++) {
                const playerY = PLAYER_START_Y - PLAYER_MOVE_SPEED * time;
                log(`æ—¶é—´${time}ç§’: Y=${playerY.toFixed(1)}px`);
            }
            
            // è®¡ç®—ç§»åŠ¨è·ç¦»
            const totalDistance = PLAYER_MOVE_SPEED * 10;
            log(`\n10ç§’æ€»ç§»åŠ¨è·ç¦»: ${totalDistance}px`);
            
            addResult('info', 'ç©å®¶ç§»åŠ¨æµ‹è¯•', `ç©å®¶10ç§’ç§»åŠ¨${totalDistance}px`);
        }

        function simulateGameplay() {
            log('ğŸ® å¼€å§‹æ¨¡æ‹Ÿæ¸¸æˆè¿‡ç¨‹...');
            
            const CANVAS_HEIGHT = 2560;
            const PLAYER_START_Y = 1280;
            const PLAYER_MOVE_SPEED = 780;
            const SAFE_DISTANCE = 1950;
            const SPAWN_DISTANCE = 300;
            const ACTIVATION_DISTANCE = CANVAS_HEIGHT * 1.5;
            
            // ç”Ÿæˆæ€ªç‰©
            const monsters = [];
            for (let i = 0; i < 10; i++) {
                const y = PLAYER_START_Y - SAFE_DISTANCE - (i + 1) * SPAWN_DISTANCE;
                monsters.push({
                    id: i + 1,
                    y: y,
                    active: false,
                    activatedAt: null
                });
            }
            
            log(`æ¸¸æˆæ¨¡æ‹Ÿå¼€å§‹:`);
            log(`é¢„ç”Ÿæˆæ€ªç‰©æ•°é‡: ${monsters.length}ä¸ª`);
            
            // æ¨¡æ‹Ÿæ¸¸æˆè¿‡ç¨‹
            let activatedCount = 0;
            for (let time = 0; time <= 20; time++) {
                const playerY = PLAYER_START_Y - PLAYER_MOVE_SPEED * time;
                
                // æ£€æŸ¥æ€ªç‰©æ¿€æ´»
                monsters.forEach(monster => {
                    if (!monster.active) {
                        const distanceToPlayer = playerY - monster.y;
                        if (distanceToPlayer < ACTIVATION_DISTANCE) {
                            monster.active = true;
                            monster.activatedAt = time;
                            activatedCount++;
                            log(`æ—¶é—´${time}ç§’: æ€ªç‰©${monster.id}æ¿€æ´» (è·ç¦»${distanceToPlayer.toFixed(1)}px)`);
                        }
                    }
                });
            }
            
            log(`\næ¸¸æˆæ¨¡æ‹Ÿç»“æœ:`);
            log(`æ¿€æ´»æ€ªç‰©æ•°é‡: ${activatedCount}/${monsters.length}ä¸ª`);
            
            if (activatedCount > 0) {
                addResult('pass', 'æ¸¸æˆæ¨¡æ‹Ÿæµ‹è¯•', `æˆåŠŸæ¿€æ´»${activatedCount}ä¸ªæ€ªç‰©`);
            } else {
                addResult('error', 'æ¸¸æˆæ¨¡æ‹Ÿæµ‹è¯•', 'æ²¡æœ‰æ¿€æ´»ä»»ä½•æ€ªç‰©');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸ‘¹ æ€ªç‰©æ¿€æ´»æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...');
        };
    </script>
</body>
</html>



