<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bugä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background-color: #2d5a2d;
            border-left: 4px solid #4caf50;
        }
        .info {
            background-color: #2d4a5a;
            border-left: 4px solid #2196f3;
        }
        .warning {
            background-color: #5a4a2d;
            border-left: 4px solid #ff9800;
        }
        .error {
            background-color: #5a2d2d;
            border-left: 4px solid #f44336;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        #log {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .fix-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .fix-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            padding: 15px;
        }
        .fix-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        .fix-item {
            margin: 5px 0;
            font-size: 14px;
        }
        .canvas-check { border-color: #4caf50; }
        .ui-check { border-color: #ff9800; }
        .monster-logic { border-color: #f44336; }
        .error-handling { border-color: #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸ› Bugä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ä¿®å¤çš„Bugæ€»ç»“</h2>
        <div class="fix-summary">
            <div class="fix-card canvas-check">
                <h3>ğŸ¯ Canvaså…ƒç´ æ£€æŸ¥</h3>
                <div class="fix-item">âœ… é—®é¢˜: æ„é€ å‡½æ•°ä¸­æœªæ£€æŸ¥Canvaså…ƒç´ æ˜¯å¦å­˜åœ¨</div>
                <div class="fix-item">âœ… ä¿®å¤: æ·»åŠ nullæ£€æŸ¥å’Œé”™è¯¯æŠ›å‡º</div>
                <div class="fix-item">âœ… å½±å“: é˜²æ­¢è¿è¡Œæ—¶é”™è¯¯</div>
            </div>
            <div class="fix-card ui-check">
                <h3>ğŸ–¥ï¸ UIå…ƒç´ æ£€æŸ¥</h3>
                <div class="fix-item">âœ… é—®é¢˜: UIç®¡ç†å™¨æœªæ£€æŸ¥DOMå…ƒç´ æ˜¯å¦å­˜åœ¨</div>
                <div class="fix-item">âœ… ä¿®å¤: æ·»åŠ ç¼ºå¤±å…ƒç´ è­¦å‘Š</div>
                <div class="fix-item">âœ… å½±å“: æé«˜è°ƒè¯•èƒ½åŠ›</div>
            </div>
            <div class="fix-card monster-logic">
                <h3>ğŸ‘¹ æ€ªç‰©ç”Ÿæˆé€»è¾‘</h3>
                <div class="fix-item">âœ… é—®é¢˜: expectedMonstersAtThisPointå˜é‡æœªä½¿ç”¨</div>
                <div class="fix-item">âœ… ä¿®å¤: æ·»åŠ å‡åŒ€åˆ†å¸ƒæ£€æŸ¥</div>
                <div class="fix-item">âœ… å½±å“: ç¡®ä¿æ€ªç‰©å‡åŒ€åˆ†å¸ƒ</div>
            </div>
            <div class="fix-card error-handling">
                <h3>âš ï¸ é”™è¯¯å¤„ç†æ”¹è¿›</h3>
                <div class="fix-item">âœ… é—®é¢˜: ç¼ºå°‘å…³é”®é”™è¯¯å¤„ç†</div>
                <div class="fix-item">âœ… ä¿®å¤: æ·»åŠ nullæ£€æŸ¥å’Œé”™è¯¯æŠ›å‡º</div>
                <div class="fix-item">âœ… å½±å“: æé«˜ä»£ç å¥å£®æ€§</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
        <button onclick="testCanvasElement()">æµ‹è¯•Canvaså…ƒç´ æ£€æŸ¥</button>
        <button onclick="testUIElements()">æµ‹è¯•UIå…ƒç´ æ£€æŸ¥</button>
        <button onclick="testMonsterLogic()">æµ‹è¯•æ€ªç‰©ç”Ÿæˆé€»è¾‘</button>
        <button onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
        <button onclick="testGameInitialization()">æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
        <div id="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        function addResult(type, title, message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `
                <div class="test-result ${type}">
                    <strong>[${timestamp}] ${title}</strong><br>
                    ${message}
                </div>
            `;
        }

        function testCanvasElement() {
            log('ğŸ¯ å¼€å§‹æµ‹è¯•Canvaså…ƒç´ æ£€æŸ¥...');
            
            // æµ‹è¯•Canvaså…ƒç´ å­˜åœ¨çš„æƒ…å†µ
            const canvas = document.getElementById('gameCanvas');
            if (canvas) {
                log('âœ… Canvaså…ƒç´ å­˜åœ¨');
                
                // æµ‹è¯•è·å–2Dä¸Šä¸‹æ–‡
                try {
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        log('âœ… æˆåŠŸè·å–2Dä¸Šä¸‹æ–‡');
                        addResult('pass', 'Canvaså…ƒç´ æ£€æŸ¥', 'Canvaså…ƒç´ å’Œ2Dä¸Šä¸‹æ–‡éƒ½æ­£å¸¸');
                    } else {
                        log('âŒ æ— æ³•è·å–2Dä¸Šä¸‹æ–‡');
                        addResult('error', 'Canvaså…ƒç´ æ£€æŸ¥', 'æ— æ³•è·å–2Dä¸Šä¸‹æ–‡');
                    }
                } catch (error) {
                    log(`âŒ è·å–2Dä¸Šä¸‹æ–‡å¤±è´¥: ${error.message}`);
                    addResult('error', 'Canvaså…ƒç´ æ£€æŸ¥', `è·å–2Dä¸Šä¸‹æ–‡å¤±è´¥: ${error.message}`);
                }
            } else {
                log('âŒ Canvaså…ƒç´ ä¸å­˜åœ¨');
                addResult('error', 'Canvaså…ƒç´ æ£€æŸ¥', 'Canvaså…ƒç´ ä¸å­˜åœ¨');
            }
        }

        function testUIElements() {
            log('ğŸ–¥ï¸ å¼€å§‹æµ‹è¯•UIå…ƒç´ æ£€æŸ¥...');
            
            const requiredElements = [
                'healthFill', 'healthText', 'scoreValue', 'levelValue', 
                'timeValue', 'progressValue', 'progressFill'
            ];
            
            const missingElements = [];
            const existingElements = [];
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    existingElements.push(id);
                    log(`âœ… UIå…ƒç´ å­˜åœ¨: ${id}`);
                } else {
                    missingElements.push(id);
                    log(`âŒ UIå…ƒç´ ç¼ºå¤±: ${id}`);
                }
            });
            
            if (missingElements.length === 0) {
                log('âœ… æ‰€æœ‰å¿…è¦çš„UIå…ƒç´ éƒ½å­˜åœ¨');
                addResult('pass', 'UIå…ƒç´ æ£€æŸ¥', 'æ‰€æœ‰å¿…è¦çš„UIå…ƒç´ éƒ½å­˜åœ¨');
            } else {
                log(`âš ï¸ ç¼ºå°‘${missingElements.length}ä¸ªUIå…ƒç´ : ${missingElements.join(', ')}`);
                addResult('warning', 'UIå…ƒç´ æ£€æŸ¥', `ç¼ºå°‘${missingElements.length}ä¸ªUIå…ƒç´ : ${missingElements.join(', ')}`);
            }
        }

        function testMonsterLogic() {
            log('ğŸ‘¹ å¼€å§‹æµ‹è¯•æ€ªç‰©ç”Ÿæˆé€»è¾‘...');
            
            // æ¨¡æ‹Ÿæ€ªç‰©ç”Ÿæˆé€»è¾‘æµ‹è¯•
            const levelConfig = {
                TOTAL_MONSTERS: 26,
                MAX_BARREL_MONSTERS: 15,
                MAX_UFO_TURRETS: 8,
                MAX_GIANT_MELEES: 3
            };
            
            const spawnPoints = 10;
            let barrelCount = 0;
            let ufoCount = 0;
            let giantCount = 0;
            
            log(`å…³å¡é…ç½®: æ€»æ€ªç‰©${levelConfig.TOTAL_MONSTERS}ä¸ª`);
            log(`ç”Ÿæˆç‚¹æ•°é‡: ${spawnPoints}ä¸ª`);
            
            // æµ‹è¯•å‡åŒ€åˆ†å¸ƒé€»è¾‘
            for (let i = 0; i < spawnPoints; i++) {
                const expectedMonstersAtThisPoint = Math.floor((i / spawnPoints) * levelConfig.TOTAL_MONSTERS);
                const monstersGeneratedSoFar = barrelCount + ufoCount + giantCount;
                const remainingMonsters = levelConfig.TOTAL_MONSTERS - monstersGeneratedSoFar;
                
                log(`ç”Ÿæˆç‚¹${i}: æœŸæœ›${expectedMonstersAtThisPoint}ä¸ª, å·²ç”Ÿæˆ${monstersGeneratedSoFar}ä¸ª, å‰©ä½™${remainingMonsters}ä¸ª`);
                
                // æ¨¡æ‹Ÿç”Ÿæˆæ€ªç‰©
                if (remainingMonsters > 0 && monstersGeneratedSoFar < expectedMonstersAtThisPoint) {
                    const generated = Math.min(2, Math.max(1, Math.floor(Math.random() * 2) + 1));
                    barrelCount += generated;
                    log(`  ç”Ÿæˆ${generated}ä¸ªæ€ªç‰©`);
                } else {
                    log(`  è·³è¿‡ç”Ÿæˆç‚¹`);
                }
            }
            
            const totalGenerated = barrelCount + ufoCount + giantCount;
            log(`æ€»ç”Ÿæˆæ€ªç‰©æ•°: ${totalGenerated}/${levelConfig.TOTAL_MONSTERS}`);
            
            if (totalGenerated <= levelConfig.TOTAL_MONSTERS) {
                log('âœ… æ€ªç‰©ç”Ÿæˆé€»è¾‘æ­£ç¡®');
                addResult('pass', 'æ€ªç‰©ç”Ÿæˆé€»è¾‘', 'æ€ªç‰©ç”Ÿæˆé€»è¾‘æ­£ç¡®ï¼Œæ•°é‡æ§åˆ¶è‰¯å¥½');
            } else {
                log('âŒ æ€ªç‰©ç”Ÿæˆæ•°é‡è¶…å‡ºé™åˆ¶');
                addResult('error', 'æ€ªç‰©ç”Ÿæˆé€»è¾‘', 'æ€ªç‰©ç”Ÿæˆæ•°é‡è¶…å‡ºé™åˆ¶');
            }
        }

        function testErrorHandling() {
            log('âš ï¸ å¼€å§‹æµ‹è¯•é”™è¯¯å¤„ç†...');
            
            // æµ‹è¯•é”™è¯¯å¤„ç†æœºåˆ¶
            const testCases = [
                {
                    name: 'Canvaså…ƒç´ ä¸å­˜åœ¨',
                    test: () => {
                        const fakeCanvas = document.getElementById('nonExistentCanvas');
                        if (!fakeCanvas) {
                            throw new Error('Canvas element with id "nonExistentCanvas" not found');
                        }
                    }
                },
                {
                    name: '2Dä¸Šä¸‹æ–‡è·å–å¤±è´¥',
                    test: () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        if (!ctx) {
                            throw new Error('Failed to get 2D context from canvas');
                        }
                    }
                },
                {
                    name: 'UIå…ƒç´ ç¼ºå¤±æ£€æŸ¥',
                    test: () => {
                        const missingElements = ['nonExistent1', 'nonExistent2'];
                        const found = missingElements.filter(id => document.getElementById(id));
                        if (found.length > 0) {
                            throw new Error('Unexpected elements found');
                        }
                    }
                }
            ];
            
            let passedTests = 0;
            let totalTests = testCases.length;
            
            testCases.forEach(testCase => {
                try {
                    testCase.test();
                    log(`âœ… ${testCase.name}: æµ‹è¯•é€šè¿‡`);
                    passedTests++;
                } catch (error) {
                    log(`âŒ ${testCase.name}: ${error.message}`);
                }
            });
            
            log(`é”™è¯¯å¤„ç†æµ‹è¯•ç»“æœ: ${passedTests}/${totalTests} é€šè¿‡`);
            
            if (passedTests === totalTests) {
                addResult('pass', 'é”™è¯¯å¤„ç†æµ‹è¯•', 'æ‰€æœ‰é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡');
            } else {
                addResult('warning', 'é”™è¯¯å¤„ç†æµ‹è¯•', `${passedTests}/${totalTests} æµ‹è¯•é€šè¿‡`);
            }
        }

        function testGameInitialization() {
            log('ğŸ® å¼€å§‹æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–...');
            
            // æ£€æŸ¥æ¸¸æˆåˆå§‹åŒ–æ‰€éœ€çš„å…³é”®ç»„ä»¶
            const components = [
                { name: 'Canvaså…ƒç´ ', check: () => document.getElementById('gameCanvas') },
                { name: 'é…ç½®å¯¹è±¡', check: () => typeof CONFIG !== 'undefined' },
                { name: 'æ¸¸æˆå¼•æ“ç±»', check: () => typeof GameEngine !== 'undefined' },
                { name: 'è¾“å…¥ç®¡ç†å™¨', check: () => typeof InputManager !== 'undefined' },
                { name: 'UIç®¡ç†å™¨', check: () => typeof UIManager !== 'undefined' },
                { name: 'å›¾ç‰‡åŠ è½½å™¨', check: () => typeof ImageLoader !== 'undefined' },
                { name: 'éŸ³é¢‘ç®¡ç†å™¨', check: () => typeof AudioManager !== 'undefined' },
                { name: 'æ‘„åƒæœºç±»', check: () => typeof Camera !== 'undefined' }
            ];
            
            let availableComponents = 0;
            let totalComponents = components.length;
            
            components.forEach(component => {
                try {
                    const result = component.check();
                    if (result) {
                        log(`âœ… ${component.name}: å¯ç”¨`);
                        availableComponents++;
                    } else {
                        log(`âŒ ${component.name}: ä¸å¯ç”¨`);
                    }
                } catch (error) {
                    log(`âŒ ${component.name}: é”™è¯¯ - ${error.message}`);
                }
            });
            
            log(`æ¸¸æˆç»„ä»¶æ£€æŸ¥ç»“æœ: ${availableComponents}/${totalComponents} å¯ç”¨`);
            
            if (availableComponents === totalComponents) {
                addResult('pass', 'æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•', 'æ‰€æœ‰æ¸¸æˆç»„ä»¶éƒ½å¯ç”¨');
            } else {
                addResult('warning', 'æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•', `${availableComponents}/${totalComponents} ç»„ä»¶å¯ç”¨`);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸ› Bugä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...');
        };
    </script>
</body>
</html>




