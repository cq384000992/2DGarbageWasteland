<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆé—®é¢˜è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .test-info {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        .success {
            color: #4ecdc4;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .warning {
            color: #ffd93d;
            font-weight: bold;
        }
        .log {
            background-color: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ¸¸æˆé—®é¢˜è°ƒè¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ é—®é¢˜åˆ—è¡¨</h2>
        <div class="test-info">
            <strong class="error">âŒ é—®é¢˜1: é‡æ–°å¼€å§‹æŒ‰é’®æ— æ³•ç‚¹å‡»</strong><br>
            ç°è±¡: æ¸¸æˆç»“æŸåï¼Œç‚¹å‡»"é‡æ–°å¼€å§‹"æŒ‰é’®æ— å“åº”<br><br>
            
            <strong class="error">âŒ é—®é¢˜2: å­å¼¹å°„ç¨‹é—®é¢˜</strong><br>
            ç°è±¡: å­å¼¹å°„ç¨‹éšæ¸¸æˆè¿›è¡Œè¶Šæ¥è¶ŠçŸ­ï¼Œæœ€ç»ˆæ— æ³•å°„å‡»<br><br>
            
            <strong class="warning">âš ï¸ è°ƒè¯•ç›®æ ‡</strong><br>
            1. éªŒè¯é‡æ–°å¼€å§‹æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®è®¾ç½®<br>
            2. éªŒè¯å­å¼¹çš„åˆ›å»ºã€æ›´æ–°ã€é”€æ¯é€»è¾‘<br>
            3. æ£€æŸ¥æ¸¸æˆçŠ¶æ€é‡ç½®é€»è¾‘
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ” é—®é¢˜1: é‡æ–°å¼€å§‹æŒ‰é’®è°ƒè¯•</h2>
        <button onclick="testRestartButton()">æµ‹è¯•é‡æ–°å¼€å§‹æŒ‰é’®</button>
        <button onclick="checkEventListeners()">æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨</button>
        <div class="log" id="restartLog"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” é—®é¢˜2: å­å¼¹å°„ç¨‹è°ƒè¯•</h2>
        <button onclick="testBulletRange()">æµ‹è¯•å­å¼¹å°„ç¨‹</button>
        <button onclick="simulateBulletLifecycle()">æ¨¡æ‹Ÿå­å¼¹ç”Ÿå‘½å‘¨æœŸ</button>
        <div class="log" id="bulletLog"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š ç»¼åˆæµ‹è¯•</h2>
        <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        <div class="log" id="fullLog"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ¸¸æˆé…ç½®
        const CONFIG = {
            PLAYER: {
                START_X: 720,
                START_Y: 1280,
                MOVE_SPEED: 780,
                BULLET_SPEED: 2400,
                BULLET_HEIGHT: 50,
                SHOOT_INTERVAL: 1667
            },
            GAME: {
                CANVAS_WIDTH: 1440,
                CANVAS_HEIGHT: 2560
            }
        };

        function log(elementId, message) {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function testRestartButton() {
            log('restartLog', '=== æµ‹è¯•é‡æ–°å¼€å§‹æŒ‰é’® ===');
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å­˜åœ¨
            const restartButton = document.getElementById('restartButton');
            if (!restartButton) {
                log('restartLog', 'âŒ é”™è¯¯: æ‰¾ä¸åˆ°é‡æ–°å¼€å§‹æŒ‰é’®');
                return;
            }
            
            log('restartLog', 'âœ… é‡æ–°å¼€å§‹æŒ‰é’®å­˜åœ¨');
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯è§
            const isVisible = restartButton.style.display !== 'none' && 
                             restartButton.offsetParent !== null;
            log('restartLog', `æŒ‰é’®å¯è§æ€§: ${isVisible ? 'å¯è§' : 'ä¸å¯è§'}`);
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»
            const isClickable = !restartButton.disabled && 
                               restartButton.style.pointerEvents !== 'none';
            log('restartLog', `æŒ‰é’®å¯ç‚¹å‡»æ€§: ${isClickable ? 'å¯ç‚¹å‡»' : 'ä¸å¯ç‚¹å‡»'}`);
            
            // æ¨¡æ‹Ÿç‚¹å‡»
            log('restartLog', 'æ¨¡æ‹Ÿç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®...');
            restartButton.click();
            log('restartLog', 'ç‚¹å‡»å®Œæˆ');
        }

        function checkEventListeners() {
            log('restartLog', '=== æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨ ===');
            
            const restartButton = document.getElementById('restartButton');
            if (!restartButton) {
                log('restartLog', 'âŒ é”™è¯¯: æ‰¾ä¸åˆ°é‡æ–°å¼€å§‹æŒ‰é’®');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶ç›‘å¬å™¨
            const hasListeners = restartButton.onclick !== null || 
                                restartButton.addEventListener !== undefined;
            log('restartLog', `äº‹ä»¶ç›‘å¬å™¨çŠ¶æ€: ${hasListeners ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            
            // æ£€æŸ¥æŒ‰é’®çš„HTMLå±æ€§
            log('restartLog', `æŒ‰é’®ID: ${restartButton.id}`);
            log('restartLog', `æŒ‰é’®æ–‡æœ¬: ${restartButton.textContent}`);
            log('restartLog', `æŒ‰é’®ç±»å‹: ${restartButton.type}`);
        }

        function testBulletRange() {
            log('bulletLog', '=== æµ‹è¯•å­å¼¹å°„ç¨‹ ===');
            
            // æ¨¡æ‹Ÿä¸åŒç©å®¶ä½ç½®çš„å­å¼¹å°„ç¨‹
            const playerPositions = [1280, 1000, 500, 0];
            
            playerPositions.forEach(playerY => {
                const bulletInitialY = playerY - CONFIG.PLAYER.BULLET_HEIGHT;
                const boundaryY = -5000;
                const bulletSpeed = CONFIG.PLAYER.BULLET_SPEED;
                
                // è®¡ç®—å­å¼¹é£è¡Œè·ç¦»
                const flightDistance = bulletInitialY - boundaryY;
                const flightTime = flightDistance / bulletSpeed;
                
                log('bulletLog', `ç©å®¶Y: ${playerY}, å­å¼¹åˆå§‹Y: ${bulletInitialY}, å°„ç¨‹: ${flightTime.toFixed(2)}ç§’`);
            });
            
            log('bulletLog', '=== å­å¼¹å°„ç¨‹åˆ†æ ===');
            log('bulletLog', 'å­å¼¹é€Ÿåº¦: 2400åƒç´ /ç§’');
            log('bulletLog', 'è¾¹ç•Œæ£€æŸ¥: y + height < -5000');
            log('bulletLog', 'ç©å®¶ç§»åŠ¨é€Ÿåº¦: 390åƒç´ /ç§’');
        }

        function simulateBulletLifecycle() {
            log('bulletLog', '=== æ¨¡æ‹Ÿå­å¼¹ç”Ÿå‘½å‘¨æœŸ ===');
            
            // æ¨¡æ‹Ÿå­å¼¹åˆ›å»º
            const playerY = 1280;
            const bulletY = playerY - CONFIG.PLAYER.BULLET_HEIGHT;
            const bulletSpeed = -CONFIG.PLAYER.BULLET_SPEED;
            
            log('bulletLog', `å­å¼¹åˆ›å»º: Y=${bulletY}, é€Ÿåº¦=${bulletSpeed}`);
            
            // æ¨¡æ‹Ÿå­å¼¹æ›´æ–°
            let currentY = bulletY;
            let time = 0;
            let step = 0;
            
            while (currentY > -5000 && step < 100) {
                time += 0.016; // çº¦60FPS
                currentY += bulletSpeed * 0.016;
                step++;
                
                if (step % 10 === 0) {
                    log('bulletLog', `æ—¶é—´: ${time.toFixed(2)}s, Y: ${currentY.toFixed(1)}`);
                }
            }
            
            log('bulletLog', `å­å¼¹é”€æ¯: æ—¶é—´=${time.toFixed(2)}s, Y=${currentY.toFixed(1)}`);
        }

        function runFullTest() {
            log('fullLog', '=== å¼€å§‹å®Œæ•´æµ‹è¯• ===');
            
            // æµ‹è¯•1: æ£€æŸ¥æ¸¸æˆå¼•æ“æ˜¯å¦å­˜åœ¨
            if (typeof gameEngine !== 'undefined') {
                log('fullLog', 'âœ… æ¸¸æˆå¼•æ“å­˜åœ¨');
                log('fullLog', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('fullLog', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
            } else {
                log('fullLog', 'âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨');
            }
            
            // æµ‹è¯•2: æ£€æŸ¥UIç®¡ç†å™¨
            if (typeof gameEngine !== 'undefined' && gameEngine.uiManager) {
                log('fullLog', 'âœ… UIç®¡ç†å™¨å­˜åœ¨');
                log('fullLog', `é‡æ–°å¼€å§‹å›è°ƒ: ${typeof gameEngine.uiManager.onGameRestart}`);
            } else {
                log('fullLog', 'âŒ UIç®¡ç†å™¨ä¸å­˜åœ¨');
            }
            
            // æµ‹è¯•3: æ£€æŸ¥å­å¼¹æ•°ç»„
            if (typeof gameEngine !== 'undefined' && gameEngine.bullets) {
                log('fullLog', `âœ… å­å¼¹æ•°ç»„å­˜åœ¨, é•¿åº¦: ${gameEngine.bullets.length}`);
            } else {
                log('fullLog', 'âŒ å­å¼¹æ•°ç»„ä¸å­˜åœ¨');
            }
            
            // æµ‹è¯•4: æ£€æŸ¥ç©å®¶å¯¹è±¡
            if (typeof gameEngine !== 'undefined' && gameEngine.player) {
                log('fullLog', 'âœ… ç©å®¶å¯¹è±¡å­˜åœ¨');
                log('fullLog', `ç©å®¶ä½ç½®: (${gameEngine.player.x}, ${gameEngine.player.y})`);
                log('fullLog', `ç©å®¶æ´»è·ƒ: ${gameEngine.player.active}`);
            } else {
                log('fullLog', 'âŒ ç©å®¶å¯¹è±¡ä¸å­˜åœ¨');
            }
            
            log('fullLog', '=== å®Œæ•´æµ‹è¯•å®Œæˆ ===');
        }

        function clearLogs() {
            document.getElementById('restartLog').textContent = '';
            document.getElementById('bulletLog').textContent = '';
            document.getElementById('fullLog').textContent = '';
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('fullLog', 'è°ƒè¯•å·¥å…·å·²åŠ è½½');
            log('fullLog', 'è¯·å…ˆæ‰“å¼€æ¸¸æˆé¡µé¢ï¼Œç„¶åè¿è¡Œæµ‹è¯•');
        };
    </script>
</body>
</html>



