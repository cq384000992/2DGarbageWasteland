<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>子弹生命周期调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .debug-info {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        .success {
            color: #4ecdc4;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .warning {
            color: #ffd93d;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>🔍 子弹生命周期调试</h1>
    
    <div class="debug-section">
        <h2>📋 调试步骤</h2>
        <ol>
            <li>打开游戏页面 (index.html)</li>
            <li>按F12打开开发者工具</li>
            <li>切换到Console标签</li>
            <li>开始游戏</li>
            <li>观察控制台输出</li>
            <li>点击下面的按钮进行分析</li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>🔍 关键调试信息</h2>
        <div class="debug-info" id="debugInfo">
            等待调试信息...
        </div>
        <button onclick="checkBulletCreation()">检查子弹创建</button>
        <button onclick="checkBulletLifecycle()">检查子弹生命周期</button>
        <button onclick="checkBulletCount()">检查子弹数量</button>
        <button onclick="clearDebugInfo()">清空信息</button>
    </div>

    <div class="debug-section">
        <h2>📊 可能的问题和解决方案</h2>
        <div class="debug-info">
            <strong class="error">问题1: 子弹创建频率异常</strong><br>
            查找: "射击: 间隔=X, 目标间隔=1667" 日志<br>
            如果间隔异常，说明射击逻辑有问题<br>
            解决: 检查射击间隔计算<br><br>
            
            <strong class="warning">问题2: 子弹数量异常</strong><br>
            查找: "子弹总数: X, 活跃子弹: Y" 日志<br>
            如果活跃子弹数量异常减少，说明有意外销毁<br>
            解决: 检查子弹销毁条件<br><br>
            
            <strong class="error">问题3: 子弹边界销毁</strong><br>
            查找: "子弹超出边界销毁" 日志<br>
            如果子弹过早销毁，说明边界检查有问题<br>
            解决: 调整边界检查逻辑<br><br>
            
            <strong class="warning">问题4: 子弹击中目标</strong><br>
            查找: "子弹击中敌人" 日志<br>
            如果子弹击中目标后销毁，这是正常的<br>
            解决: 检查是否有误判的碰撞
        </div>
    </div>

    <div class="test-section">
        <h2>🎯 快速诊断</h2>
        <button onclick="diagnoseBulletIssue()">自动诊断</button>
        <button onclick="testBulletCreation()">测试子弹创建</button>
        <button onclick="testBulletDestruction()">测试子弹销毁</button>
    </div>

    <script>
        function checkBulletCreation() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>子弹创建检查:</strong><br><br>
                
                <strong>1. 查找射击日志:</strong><br>
                - "射击: 间隔=X, 目标间隔=1667, 当前时间=Y, 上次射击=Z"<br>
                - 间隔应该接近1667毫秒<br><br>
                
                <strong>2. 查找创建日志:</strong><br>
                - "创建子弹: 位置(X, Y), 速度(VX, VY), 总数: N"<br>
                - 应该每1.667秒创建一颗子弹<br><br>
                
                <strong>3. 检查射击条件:</strong><br>
                - 射击间隔: 1667毫秒<br>
                - 子弹速度: 2400像素/秒<br>
                - 子弹伤害: 10<br><br>
                
                <strong>如果射击异常:</strong><br>
                1. 检查射击间隔计算<br>
                2. 检查时间戳是否正确<br>
                3. 检查射击条件是否满足
            `;
        }

        function checkBulletLifecycle() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>子弹生命周期检查:</strong><br><br>
                
                <strong>1. 创建阶段:</strong><br>
                - 每1.667秒创建一颗子弹<br>
                - 子弹位置: 玩家位置上方<br>
                - 子弹速度: (0, -2400) 向上移动<br><br>
                
                <strong>2. 更新阶段:</strong><br>
                - 每帧更新子弹位置<br>
                - 检查边界条件<br>
                - 检查碰撞条件<br><br>
                
                <strong>3. 销毁阶段:</strong><br>
                - 击中敌人: 正常销毁<br>
                - 击中障碍物: 正常销毁<br>
                - 超出边界: 需要检查<br>
                - 其他原因: 异常<br><br>
                
                <strong>如果生命周期异常:</strong><br>
                1. 检查子弹更新逻辑<br>
                2. 检查子弹销毁条件<br>
                3. 检查子弹状态管理
            `;
        }

        function checkBulletCount() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>子弹数量检查:</strong><br><br>
                
                <strong>1. 查找数量日志:</strong><br>
                - "子弹总数: X, 活跃子弹: Y"<br>
                - 活跃子弹应该等于总数<br><br>
                
                <strong>2. 数量变化分析:</strong><br>
                - 创建时: 总数+1<br>
                - 销毁时: 总数-1<br>
                - 清理时: 移除非活跃子弹<br><br>
                
                <strong>3. 异常情况:</strong><br>
                - 总数增加但活跃数不增加: 创建失败<br>
                - 总数减少但活跃数不减少: 清理异常<br>
                - 活跃数异常减少: 意外销毁<br><br>
                
                <strong>如果数量异常:</strong><br>
                1. 检查子弹创建逻辑<br>
                2. 检查子弹销毁逻辑<br>
                3. 检查子弹清理逻辑
            `;
        }

        function clearDebugInfo() {
            document.getElementById('debugInfo').innerHTML = '等待调试信息...';
        }

        function diagnoseBulletIssue() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>自动诊断结果:</strong><br><br>
                
                <strong>最可能的问题:</strong><br>
                1. 子弹创建频率异常<br>
                2. 子弹数量管理问题<br>
                3. 子弹边界检查过于严格<br>
                4. 子弹碰撞检测误判<br><br>
                
                <strong>建议检查顺序:</strong><br>
                1. 查看是否有 "射击" 日志<br>
                2. 查看是否有 "创建子弹" 日志<br>
                3. 查看 "子弹总数" 日志<br>
                4. 查看 "子弹超出边界销毁" 日志<br>
                5. 查看 "子弹击中敌人" 日志<br><br>
                
                <strong>快速修复建议:</strong><br>
                1. 如果子弹创建异常，检查射击间隔<br>
                2. 如果子弹数量异常，检查清理逻辑<br>
                3. 如果子弹过早销毁，调整边界检查<br>
                4. 如果子弹击中空气，检查碰撞检测
            `;
        }

        function testBulletCreation() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>子弹创建测试:</strong><br><br>
                
                <strong>测试方法:</strong><br>
                1. 开始游戏<br>
                2. 等待2-3秒<br>
                3. 观察是否创建了子弹<br>
                4. 观察创建频率是否正常<br><br>
                
                <strong>预期结果:</strong><br>
                - 每1.667秒创建一颗子弹<br>
                - 创建日志显示正确的位置和速度<br>
                - 子弹总数逐渐增加<br><br>
                
                <strong>异常情况:</strong><br>
                - 没有创建日志: 射击逻辑有问题<br>
                - 创建频率异常: 射击间隔有问题<br>
                - 创建位置异常: 玩家位置有问题
            `;
        }

        function testBulletDestruction() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>子弹销毁测试:</strong><br><br>
                
                <strong>测试方法:</strong><br>
                1. 开始游戏<br>
                2. 连续射击<br>
                3. 观察子弹销毁原因<br>
                4. 观察子弹数量变化<br><br>
                
                <strong>预期结果:</strong><br>
                - 子弹击中敌人后销毁<br>
                - 子弹超出边界后销毁<br>
                - 子弹数量保持合理范围<br><br>
                
                <strong>异常情况:</strong><br>
                - 子弹过早销毁: 边界检查有问题<br>
                - 子弹击中空气: 碰撞检测有问题<br>
                - 子弹数量异常: 清理逻辑有问题
            `;
        }

        // 页面加载时的提示
        window.onload = function() {
            checkBulletCreation();
        };
    </script>
</body>
</html>



