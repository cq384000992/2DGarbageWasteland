<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background-color: #2d5a2d;
            border-left: 4px solid #4caf50;
        }
        .info {
            background-color: #2d4a5a;
            border-left: 4px solid #2196f3;
        }
        .warning {
            background-color: #5a4a2d;
            border-left: 4px solid #ff9800;
        }
        .error {
            background-color: #5a2d2d;
            border-left: 4px solid #f44336;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        #log {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .fix-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .fix-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            padding: 15px;
        }
        .fix-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        .fix-item {
            margin: 5px 0;
            font-size: 14px;
        }
        .bullet-fix { border-color: #4caf50; }
        .monster-fix { border-color: #ff9800; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ä¿®å¤å†…å®¹æ€»ç»“</h2>
        <div class="fix-summary">
            <div class="fix-card bullet-fix">
                <h3>ğŸ”« å­å¼¹æ¶ˆå¤±é—®é¢˜ä¿®å¤</h3>
                <div class="fix-item">âœ… é—®é¢˜: å­å¼¹è°ƒç”¨çˆ¶ç±»updateå¯¼è‡´è¾¹ç•Œæ£€æŸ¥å†²çª</div>
                <div class="fix-item">âœ… ä¿®å¤: å­å¼¹ç‹¬ç«‹å®ç°updateæ–¹æ³•</div>
                <div class="fix-item">âœ… æ•ˆæœ: å­å¼¹ä¸å†è¢«é”™è¯¯é”€æ¯</div>
            </div>
            <div class="fix-card monster-fix">
                <h3>ğŸ‘¹ æ€ªç‰©ç”Ÿæˆé—®é¢˜ä¿®å¤</h3>
                <div class="fix-item">âœ… é—®é¢˜: æ€ªç‰©ç”Ÿæˆæ¡ä»¶è¿‡äºä¸¥æ ¼</div>
                <div class="fix-item">âœ… ä¿®å¤: æ”¾å®½ç”Ÿæˆæ¡ä»¶ï¼Œå¢åŠ å®¹é”™èŒƒå›´</div>
                <div class="fix-item">âœ… æ•ˆæœ: æ€ªç‰©æ­£å¸¸ç”Ÿæˆ</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
        <button onclick="testBulletLogic()">æµ‹è¯•å­å¼¹é€»è¾‘</button>
        <button onclick="testMonsterSpawnLogic()">æµ‹è¯•æ€ªç‰©ç”Ÿæˆé€»è¾‘</button>
        <button onclick="testGameInitialization()">æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–</button>
        <button onclick="simulateGameplay()">æ¨¡æ‹Ÿæ¸¸æˆè¿‡ç¨‹</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
        <div id="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        function addResult(type, title, message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `
                <div class="test-result ${type}">
                    <strong>[${timestamp}] ${title}</strong><br>
                    ${message}
                </div>
            `;
        }

        function testBulletLogic() {
            log('ğŸ”« å¼€å§‹æµ‹è¯•å­å¼¹é€»è¾‘...');
            
            // æ¨¡æ‹Ÿå­å¼¹åˆ›å»ºå’Œæ›´æ–°
            const bulletConfig = {
                x: 720,
                y: 1000,
                velocityX: 0,
                velocityY: -2400, // 300%é€Ÿåº¦æå‡
                width: 20,
                height: 50,
                active: true
            };
            
            log(`å­å¼¹åˆå§‹ä½ç½®: (${bulletConfig.x}, ${bulletConfig.y})`);
            log(`å­å¼¹é€Ÿåº¦: (${bulletConfig.velocityX}, ${bulletConfig.velocityY})`);
            
            // æ¨¡æ‹Ÿå­å¼¹ç§»åŠ¨
            const deltaTime = 1/60; // 60FPS
            let bulletY = bulletConfig.y;
            let frameCount = 0;
            
            while (bulletY > -10000 && frameCount < 1000) {
                bulletY += bulletConfig.velocityY * deltaTime;
                frameCount++;
                
                if (frameCount % 60 === 0) { // æ¯ç§’è¾“å‡ºä¸€æ¬¡
                    log(`ç¬¬${frameCount/60}ç§’: å­å¼¹Yä½ç½®=${bulletY.toFixed(1)}`);
                }
            }
            
            log(`å­å¼¹é£è¡Œæ—¶é—´: ${frameCount/60}ç§’`);
            log(`å­å¼¹æœ€ç»ˆYä½ç½®: ${bulletY.toFixed(1)}`);
            
            if (frameCount >= 1000) {
                log('âœ… å­å¼¹é£è¡Œæ—¶é—´è¶…è¿‡16ç§’ï¼Œå°„ç¨‹å……è¶³');
                addResult('pass', 'å­å¼¹é€»è¾‘æµ‹è¯•', 'å­å¼¹å°„ç¨‹å……è¶³ï¼Œä¸ä¼šè¿‡æ—©æ¶ˆå¤±');
            } else {
                log('âŒ å­å¼¹é£è¡Œæ—¶é—´è¿‡çŸ­');
                addResult('error', 'å­å¼¹é€»è¾‘æµ‹è¯•', 'å­å¼¹å°„ç¨‹ä¸è¶³');
            }
        }

        function testMonsterSpawnLogic() {
            log('ğŸ‘¹ å¼€å§‹æµ‹è¯•æ€ªç‰©ç”Ÿæˆé€»è¾‘...');
            
            // æ¨¡æ‹Ÿå…³å¡é…ç½®
            const levelConfig = {
                TOTAL_MONSTERS: 26,
                MAX_BARREL_MONSTERS: 15,
                MAX_UFO_TURRETS: 8,
                MAX_GIANT_MELEES: 3
            };
            
            const spawnPoints = 20; // æ¨¡æ‹Ÿç”Ÿæˆç‚¹æ•°é‡
            let barrelCount = 0;
            let ufoCount = 0;
            let giantCount = 0;
            let totalGenerated = 0;
            
            log(`å…³å¡é…ç½®: æ€»æ€ªç‰©${levelConfig.TOTAL_MONSTERS}ä¸ª`);
            log(`ç”Ÿæˆç‚¹æ•°é‡: ${spawnPoints}ä¸ª`);
            
            // æ¨¡æ‹Ÿæ€ªç‰©ç”Ÿæˆé€»è¾‘
            for (let i = 0; i < spawnPoints; i++) {
                const totalMonsters = levelConfig.TOTAL_MONSTERS;
                const expectedMonstersAtThisPoint = Math.floor((i / spawnPoints) * totalMonsters);
                const monstersGeneratedSoFar = barrelCount + ufoCount + giantCount;
                const remainingMonsters = totalMonsters - monstersGeneratedSoFar;
                
                // ä¿®å¤åçš„é€»è¾‘
                if (remainingMonsters <= 0) {
                    log(`ç”Ÿæˆç‚¹${i}: è·³è¿‡ - æ€ªç‰©å·²æ»¡`);
                    continue;
                }
                
                if (monstersGeneratedSoFar >= expectedMonstersAtThisPoint + 2) {
                    log(`ç”Ÿæˆç‚¹${i}: è·³è¿‡ - è¿›åº¦å·²è¾¾æ ‡ (${monstersGeneratedSoFar} >= ${expectedMonstersAtThisPoint + 2})`);
                    continue;
                }
                
                // æ¨¡æ‹Ÿç”Ÿæˆæ€ªç‰©
                const generated = Math.min(2, Math.max(1, Math.floor(Math.random() * 2) + 1));
                barrelCount += generated;
                totalGenerated += generated;
                
                log(`ç”Ÿæˆç‚¹${i}: ç”Ÿæˆ${generated}ä¸ªæ€ªç‰© (æ€»è®¡${totalGenerated}ä¸ª)`);
            }
            
            log(`æ€ªç‰©ç”Ÿæˆç»“æœ: ${totalGenerated}/${levelConfig.TOTAL_MONSTERS}`);
            
            if (totalGenerated > 0) {
                log('âœ… æ€ªç‰©ç”Ÿæˆé€»è¾‘æ­£å¸¸');
                addResult('pass', 'æ€ªç‰©ç”Ÿæˆé€»è¾‘æµ‹è¯•', `æˆåŠŸç”Ÿæˆ${totalGenerated}ä¸ªæ€ªç‰©`);
            } else {
                log('âŒ æ€ªç‰©ç”Ÿæˆé€»è¾‘æœ‰é—®é¢˜');
                addResult('error', 'æ€ªç‰©ç”Ÿæˆé€»è¾‘æµ‹è¯•', 'æ²¡æœ‰ç”Ÿæˆä»»ä½•æ€ªç‰©');
            }
        }

        function testGameInitialization() {
            log('ğŸ® å¼€å§‹æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–...');
            
            // æ£€æŸ¥å…³é”®ç»„ä»¶
            const components = [
                { name: 'CONFIG', check: () => typeof CONFIG !== 'undefined' },
                { name: 'GameEngine', check: () => typeof GameEngine !== 'undefined' },
                { name: 'Player', check: () => typeof Player !== 'undefined' },
                { name: 'Bullet', check: () => typeof Bullet !== 'undefined' },
                { name: 'BarrelMonster', check: () => typeof BarrelMonster !== 'undefined' },
                { name: 'UFOTurret', check: () => typeof UFOTurret !== 'undefined' },
                { name: 'GiantMelee', check: () => typeof GiantMelee !== 'undefined' }
            ];
            
            let availableComponents = 0;
            let totalComponents = components.length;
            
            components.forEach(component => {
                try {
                    const result = component.check();
                    if (result) {
                        log(`âœ… ${component.name}: å¯ç”¨`);
                        availableComponents++;
                    } else {
                        log(`âŒ ${component.name}: ä¸å¯ç”¨`);
                    }
                } catch (error) {
                    log(`âŒ ${component.name}: é”™è¯¯ - ${error.message}`);
                }
            });
            
            log(`æ¸¸æˆç»„ä»¶æ£€æŸ¥ç»“æœ: ${availableComponents}/${totalComponents} å¯ç”¨`);
            
            if (availableComponents === totalComponents) {
                addResult('pass', 'æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•', 'æ‰€æœ‰æ¸¸æˆç»„ä»¶éƒ½å¯ç”¨');
            } else {
                addResult('warning', 'æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•', `${availableComponents}/${totalComponents} ç»„ä»¶å¯ç”¨`);
            }
        }

        function simulateGameplay() {
            log('ğŸ¯ å¼€å§‹æ¨¡æ‹Ÿæ¸¸æˆè¿‡ç¨‹...');
            
            // æ¨¡æ‹Ÿæ¸¸æˆé…ç½®
            const gameConfig = {
                playerSpeed: 780, // 2å€é€Ÿåº¦
                bulletSpeed: 2400, // 300%æå‡
                shootInterval: 1667, // 0.6å‘/ç§’
                level1Monsters: 26,
                level2Monsters: 48
            };
            
            log('æ¸¸æˆé…ç½®:');
            log(`- ç©å®¶é€Ÿåº¦: ${gameConfig.playerSpeed}åƒç´ /ç§’`);
            log(`- å­å¼¹é€Ÿåº¦: ${gameConfig.bulletSpeed}åƒç´ /ç§’`);
            log(`- å°„å‡»é—´éš”: ${gameConfig.shootInterval}æ¯«ç§’`);
            log(`- å…³å¡1æ€ªç‰©: ${gameConfig.level1Monsters}ä¸ª`);
            log(`- å…³å¡2æ€ªç‰©: ${gameConfig.level2Monsters}ä¸ª`);
            
            // æ¨¡æ‹Ÿå…³å¡1
            log('\næ¨¡æ‹Ÿå…³å¡1:');
            const level1Time = 80; // 80ç§’
            const level1Shots = Math.floor(level1Time * 1000 / gameConfig.shootInterval);
            log(`- å…³å¡æ—¶é•¿: ${level1Time}ç§’`);
            log(`- é¢„è®¡å°„å‡»æ¬¡æ•°: ${level1Shots}æ¬¡`);
            log(`- æ€ªç‰©æ•°é‡: ${gameConfig.level1Monsters}ä¸ª`);
            
            // æ¨¡æ‹Ÿå…³å¡2
            log('\næ¨¡æ‹Ÿå…³å¡2:');
            const level2Time = 120; // 120ç§’
            const level2Shots = Math.floor(level2Time * 1000 / gameConfig.shootInterval);
            log(`- å…³å¡æ—¶é•¿: ${level2Time}ç§’`);
            log(`- é¢„è®¡å°„å‡»æ¬¡æ•°: ${level2Shots}æ¬¡`);
            log(`- æ€ªç‰©æ•°é‡: ${gameConfig.level2Monsters}ä¸ª`);
            
            // è®¡ç®—æ¸¸æˆå¹³è¡¡
            const totalShots = level1Shots + level2Shots;
            const totalMonsters = gameConfig.level1Monsters + gameConfig.level2Monsters;
            const shotsPerMonster = totalShots / totalMonsters;
            
            log(`\næ¸¸æˆå¹³è¡¡åˆ†æ:`);
            log(`- æ€»å°„å‡»æ¬¡æ•°: ${totalShots}æ¬¡`);
            log(`- æ€»æ€ªç‰©æ•°é‡: ${totalMonsters}ä¸ª`);
            log(`- æ¯æ€ªç‰©å¹³å‡å°„å‡»: ${shotsPerMonster.toFixed(1)}æ¬¡`);
            
            if (shotsPerMonster >= 1 && shotsPerMonster <= 3) {
                log('âœ… æ¸¸æˆå¹³è¡¡è‰¯å¥½');
                addResult('pass', 'æ¸¸æˆå¹³è¡¡æµ‹è¯•', 'æ¸¸æˆå¹³è¡¡è‰¯å¥½ï¼Œå°„å‡»é¢‘ç‡é€‚ä¸­');
            } else {
                log('âš ï¸ æ¸¸æˆå¹³è¡¡éœ€è¦è°ƒæ•´');
                addResult('warning', 'æ¸¸æˆå¹³è¡¡æµ‹è¯•', 'æ¸¸æˆå¹³è¡¡éœ€è¦è°ƒæ•´');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...');
        };
    </script>
</body>
</html>




