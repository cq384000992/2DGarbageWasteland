<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°å¼€å§‹æŒ‰é’®è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0f0f23;
            color: white;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #4ecdc4;
            border-radius: 5px;
        }
        .debug-info {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background-color: #4ecdc4;
            color: #0f0f23;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45b7b8;
        }
        .success {
            color: #4ecdc4;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            font-weight: bold;
        }
        .warning {
            color: #ffd93d;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ é‡æ–°å¼€å§‹æŒ‰é’®è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h2>ğŸ“‹ æŒ‰é’®çŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="checkRestartButton()">æ£€æŸ¥é‡æ–°å¼€å§‹æŒ‰é’®</button>
        <button onclick="checkGameState()">æ£€æŸ¥æ¸¸æˆçŠ¶æ€</button>
        <button onclick="checkEventListeners()">æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨</button>
        <div class="debug-info" id="buttonInfo"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸ¯ æ¨¡æ‹Ÿæ¸¸æˆç»“æŸ</h2>
        <button onclick="simulateGameOver()">æ¨¡æ‹Ÿæ¸¸æˆç»“æŸ</button>
        <button onclick="testRestartClick()">æµ‹è¯•é‡æ–°å¼€å§‹ç‚¹å‡»</button>
        <button onclick="manualRestart()">æ‰‹åŠ¨é‡æ–°å¼€å§‹</button>
        <div class="debug-info" id="gameInfo"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸ” è¯¦ç»†è°ƒè¯•</h2>
        <button onclick="debugUIManager()">è°ƒè¯•UIç®¡ç†å™¨</button>
        <button onclick="debugGameEngine()">è°ƒè¯•æ¸¸æˆå¼•æ“</button>
        <div class="debug-info" id="debugInfo"></div>
    </div>

    <script>
        function log(elementId, message) {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function checkRestartButton() {
            log('buttonInfo', '=== æ£€æŸ¥é‡æ–°å¼€å§‹æŒ‰é’® ===');
            
            const restartButton = document.getElementById('restartButton');
            if (!restartButton) {
                log('buttonInfo', 'âŒ æ‰¾ä¸åˆ°é‡æ–°å¼€å§‹æŒ‰é’®');
                return;
            }
            
            log('buttonInfo', 'âœ… é‡æ–°å¼€å§‹æŒ‰é’®å­˜åœ¨');
            log('buttonInfo', `æŒ‰é’®ID: ${restartButton.id}`);
            log('buttonInfo', `æŒ‰é’®æ–‡æœ¬: ${restartButton.textContent}`);
            log('buttonInfo', `æŒ‰é’®ç±»å‹: ${restartButton.type}`);
            log('buttonInfo', `æŒ‰é’®å¯è§æ€§: ${restartButton.style.display !== 'none' ? 'å¯è§' : 'ä¸å¯è§'}`);
            log('buttonInfo', `æŒ‰é’®å¯ç‚¹å‡»æ€§: ${!restartButton.disabled ? 'å¯ç‚¹å‡»' : 'ä¸å¯ç‚¹å‡»'}`);
            log('buttonInfo', `æŒ‰é’®ä½ç½®: ${restartButton.offsetLeft}, ${restartButton.offsetTop}`);
            log('buttonInfo', `æŒ‰é’®å°ºå¯¸: ${restartButton.offsetWidth}x${restartButton.offsetHeight}`);
        }

        function checkGameState() {
            log('buttonInfo', '=== æ£€æŸ¥æ¸¸æˆçŠ¶æ€ ===');
            
            if (typeof gameEngine !== 'undefined' && gameEngine) {
                log('buttonInfo', 'âœ… æ¸¸æˆå¼•æ“å­˜åœ¨');
                log('buttonInfo', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('buttonInfo', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
                log('buttonInfo', `å½“å‰å…³å¡: ${gameEngine.currentLevel}`);
                log('buttonInfo', `åˆ†æ•°: ${gameEngine.score}`);
            } else {
                log('buttonInfo', 'âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨');
            }
        }

        function checkEventListeners() {
            log('buttonInfo', '=== æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨ ===');
            
            const restartButton = document.getElementById('restartButton');
            if (!restartButton) {
                log('buttonInfo', 'âŒ æ‰¾ä¸åˆ°é‡æ–°å¼€å§‹æŒ‰é’®');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶ç›‘å¬å™¨
            const hasListeners = restartButton.onclick !== null || 
                                restartButton.addEventListener !== undefined;
            log('buttonInfo', `äº‹ä»¶ç›‘å¬å™¨çŠ¶æ€: ${hasListeners ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            
            // æ£€æŸ¥UIç®¡ç†å™¨
            if (typeof gameEngine !== 'undefined' && gameEngine && gameEngine.uiManager) {
                log('buttonInfo', 'âœ… UIç®¡ç†å™¨å­˜åœ¨');
                log('buttonInfo', `é‡æ–°å¼€å§‹å›è°ƒ: ${typeof gameEngine.uiManager.onGameRestart}`);
                log('buttonInfo', `é‡æ–°å¼€å§‹å¤„ç†å™¨: ${typeof gameEngine.uiManager.restartButtonHandler}`);
            } else {
                log('buttonInfo', 'âŒ UIç®¡ç†å™¨ä¸å­˜åœ¨');
            }
        }

        function simulateGameOver() {
            log('gameInfo', '=== æ¨¡æ‹Ÿæ¸¸æˆç»“æŸ ===');
            
            if (typeof gameEngine !== 'undefined' && gameEngine) {
                log('gameInfo', 'è°ƒç”¨gameOver()æ–¹æ³•...');
                gameEngine.gameOver();
                log('gameInfo', 'gameOver()è°ƒç”¨å®Œæˆ');
                log('gameInfo', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('gameInfo', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
                
                // æ£€æŸ¥æ¸¸æˆç»“æŸç•Œé¢æ˜¯å¦æ˜¾ç¤º
                const gameOverScreen = document.getElementById('gameOverScreen');
                if (gameOverScreen) {
                    log('gameInfo', `æ¸¸æˆç»“æŸç•Œé¢æ˜¾ç¤ºçŠ¶æ€: ${gameOverScreen.style.display}`);
                }
            } else {
                log('gameInfo', 'âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨');
            }
        }

        function testRestartClick() {
            log('gameInfo', '=== æµ‹è¯•é‡æ–°å¼€å§‹ç‚¹å‡» ===');
            
            const restartButton = document.getElementById('restartButton');
            if (!restartButton) {
                log('gameInfo', 'âŒ æ‰¾ä¸åˆ°é‡æ–°å¼€å§‹æŒ‰é’®');
                return;
            }
            
            log('gameInfo', 'æ¨¡æ‹Ÿç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®...');
            restartButton.click();
            log('gameInfo', 'ç‚¹å‡»å®Œæˆ');
            
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€æ˜¯å¦æ”¹å˜
            if (typeof gameEngine !== 'undefined' && gameEngine) {
                log('gameInfo', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('gameInfo', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
            }
        }

        function manualRestart() {
            log('gameInfo', '=== æ‰‹åŠ¨é‡æ–°å¼€å§‹ ===');
            
            if (typeof gameEngine !== 'undefined' && gameEngine) {
                log('gameInfo', 'è°ƒç”¨restartGame()æ–¹æ³•...');
                gameEngine.restartGame();
                log('gameInfo', 'restartGame()è°ƒç”¨å®Œæˆ');
                log('gameInfo', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('gameInfo', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
            } else {
                log('gameInfo', 'âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨');
            }
        }

        function debugUIManager() {
            log('debugInfo', '=== è°ƒè¯•UIç®¡ç†å™¨ ===');
            
            if (typeof gameEngine !== 'undefined' && gameEngine && gameEngine.uiManager) {
                const uiManager = gameEngine.uiManager;
                log('debugInfo', 'âœ… UIç®¡ç†å™¨å­˜åœ¨');
                log('debugInfo', `å¼€å§‹å›è°ƒ: ${typeof uiManager.onGameStart}`);
                log('debugInfo', `é‡æ–°å¼€å§‹å›è°ƒ: ${typeof uiManager.onGameRestart}`);
                log('debugInfo', `ä¸‹ä¸€å…³å›è°ƒ: ${typeof uiManager.onNextLevel}`);
                log('debugInfo', `å¼€å§‹æŒ‰é’®å¤„ç†å™¨: ${typeof uiManager.startButtonHandler}`);
                log('debugInfo', `é‡æ–°å¼€å§‹æŒ‰é’®å¤„ç†å™¨: ${typeof uiManager.restartButtonHandler}`);
                log('debugInfo', `ä¸‹ä¸€å…³æŒ‰é’®å¤„ç†å™¨: ${typeof uiManager.nextLevelButtonHandler}`);
            } else {
                log('debugInfo', 'âŒ UIç®¡ç†å™¨ä¸å­˜åœ¨');
            }
        }

        function debugGameEngine() {
            log('debugInfo', '=== è°ƒè¯•æ¸¸æˆå¼•æ“ ===');
            
            if (typeof gameEngine !== 'undefined' && gameEngine) {
                log('debugInfo', 'âœ… æ¸¸æˆå¼•æ“å­˜åœ¨');
                log('debugInfo', `æ¸¸æˆçŠ¶æ€: ${gameEngine.gameState}`);
                log('debugInfo', `æ˜¯å¦è¿è¡Œ: ${gameEngine.isRunning}`);
                log('debugInfo', `åŠ¨ç”»ID: ${gameEngine.animationId}`);
                log('debugInfo', `å½“å‰å…³å¡: ${gameEngine.currentLevel}`);
                log('debugInfo', `åˆ†æ•°: ${gameEngine.score}`);
                log('debugInfo', `ç©å®¶: ${gameEngine.player ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                log('debugInfo', `æ•Œäººæ•°é‡: ${gameEngine.enemies ? gameEngine.enemies.length : 0}`);
                log('debugInfo', `å­å¼¹æ•°é‡: ${gameEngine.bullets ? gameEngine.bullets.length : 0}`);
            } else {
                log('debugInfo', 'âŒ æ¸¸æˆå¼•æ“ä¸å­˜åœ¨');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('buttonInfo', 'é¡µé¢åŠ è½½å®Œæˆ');
            log('buttonInfo', 'è¯·è¿è¡Œæ£€æŸ¥æ¥è¯Šæ–­é—®é¢˜');
        };

        // ç›‘å¬é”™è¯¯äº‹ä»¶
        window.addEventListener('error', function(event) {
            log('debugInfo', `âŒ å…¨å±€é”™è¯¯: ${event.error.message}`);
        });
    </script>

    <!-- åŠ è½½æ¸¸æˆæ–‡ä»¶ -->
    <script src="config.js"></script>
    <script src="imageLoader.js"></script>
    <script src="audioManager.js"></script>
    <script src="camera.js"></script>
    <script src="gameObjects.js"></script>
    <script src="inputHandler.js"></script>
    <script src="uiManager.js"></script>
    <script src="gameEngine.js"></script>
</body>
</html>




